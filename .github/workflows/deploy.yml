name: Deploy to Production Server

on:
  push:
    branches: [ main, master ]
  # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
  # pull_request:
  #   branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to server via SSH
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USERNAME }}
          key: ${{ secrets.PRIVATE_KEY }}
          #passphrase: ${{ secrets.SSH_PASSPHRASE }}   # –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç —Å –ø–∞—Ä–æ–ª—å–Ω–æ–π —Ñ—Ä–∞–∑–æ–π
          port: 22
          script_stop: true
          script: |
            echo "üöÄ Starting deployment..."
            cd ~/deploy-test
            
            # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            git fetch origin
            git reset --hard origin/main
            
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
            #sudo chown -R deployer:www-data .
            #sudo chmod -R 775 storage bootstrap/cache
            
            echo "‚úÖ Deployment completed successfully!"